<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="portal_my_job_responsibilities" name="My Job Responsibilities">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <div class="o_portal_wrap">
                <div class="o_portal_page_header d-flex justify-content-between align-items-center flex-wrap gap-2">
                    <h1 class="o_portal_page_heading">Job Responsibilities</h1>
                    <form method="get" class="d-flex align-items-center">
                        <label class="me-2 mb-0">Sort</label>
                        <select name="sortby" class="form-select" onchange="this.form.submit()">
                            <t t-foreach="sort_options.items()" t-as="option">
                                <t t-set="key" t-value="option[0]"/>
                                <t t-set="data" t-value="option[1]"/>
                                <option t-att-value="key" t-att-selected="key == sortby"><t t-esc="data['label']"/></option>
                            </t>
                        </select>
                    </form>
                </div>

                <table class="table table-sm o_portal_table mt-3">
                    <thead>
                        <tr>
                            <th>Reference</th>
                            <th>Job Position</th>
                            <th>Issue Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="jrs" t-as="jr">
                            <td>
                                <a t-att-href="jr.get_portal_url()"><t t-esc="jr.name"/></a>
                            </td>
                            <td><t t-esc="jr.job_id.display_name or ''"/></td>
                            <td><t t-esc="jr.issue_date or ''"/></td>
                            <td><span class="badge bg-secondary"><t t-esc="jr.state"/></span></td>
                        </tr>
                        <tr t-if="not jrs">
                            <td colspan="4" class="text-center text-muted">No job responsibilities found.</td>
                        </tr>
                    </tbody>
                </table>

                <div t-if="pager" class="o_portal_pager d-flex justify-content-center my-3">
                    <t t-call="portal.pager"/>
                </div>
            </div>
        </t>
    </template>

    <template id="portal_my_home_jr" inherit_id="portal.portal_my_home" name="Portal Home: Job Responsibilities">
        <xpath expr="//div[@id='portal_common_category']" position="inside">
            <t t-call="portal.portal_docs_entry">
                <t t-set="icon" t-value="'/portal/static/src/img/portal-project.svg'"/>
                <t t-set="title">Job Responsibilities</t>
                <t t-set="text">View responsibilities issued to you</t>
                <t t-set="url" t-value="'/my/job-responsibilities'"/>
                <t t-set="show_count" t-value="True"/>
                <t t-set="count" t-value="jr_count"/>
                <t t-set="placeholder_count" t-value="'jr_count'"/>
            </t>
        </xpath>
    </template>

    <template id="portal_jr_detail" name="Job Responsibility Detail">
        <t t-call="portal.portal_layout">
            <div class="o_portal_wrap">
                <div class="o_portal_page_header d-flex justify-content-between align-items-center flex-wrap gap-2">
                    <h1 class="o_portal_page_heading">
                        <t t-esc="jr.name"/>
                        <span class="badge bg-secondary ms-2"><t t-esc="jr.state"/></span>
                    </h1>
                    <a class="btn btn-primary" t-att-href="'/my/job-responsibilities/%s/print' % jr.id">
                        <i class="fa fa-download me-1"/> Download PDF
                    </a>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <table class="table table-borderless o_portal_info_table">
                            <tr><th>Employee</th><td><t t-esc="jr.employee_id.display_name"/></td></tr>
                            <tr><th>Job Position</th><td><t t-esc="jr.job_id.display_name"/></td></tr>
                            <tr><th>Issue Date</th><td><t t-esc="jr.issue_date or ''"/></td></tr>
                            <tr><th>Company</th><td><t t-esc="jr.company_id.display_name"/></td></tr>
                        </table>
                    </div>
                </div>

                <h3 class="mt-4">Responsibilities</h3>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Description</th>
                            <th>KPI Hint</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="jr.line_ids" t-as="line">
                            <t t-if="line.emphasize">
                                <td colspan="3" style="font-weight:700; text-align:center;">
                                    <t t-esc="line.description"/>
                                </td>
                            </t>
                            <t t-else="">
                                <td><t t-esc="line.sequence"/></td>
                                <td><t t-esc="line.description"/></td>
                                <td><t t-esc="line.kpi_hint"/></td>
                            </t>
                        </tr>
                        <tr t-if="not jr.line_ids">
                            <td colspan="3" class="text-center text-muted">No responsibilities listed.</td>
                        </tr>
                    </tbody>
                </table>

                <div class="mt-3">
                    <a class="btn btn-secondary" href="/my/job-responsibilities">
                        <i class="fa fa-arrow-left me-1"/> Back to list
                    </a>
                </div>
            </div>
        </t>
    </template>
</odoo>
