<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="view_batching_master_calculator_form" model="ir.ui.view">
        <field name="name">gear.batching.master.calculator.form</field>
        <field name="model">gear.batching.master.calculator</field>
        <field name="arch" type="xml">
            <form string="Batching Master Calculator" class="o_form_readonly">
                <sheet>
                    <group col="4">
                        <field name="order_id" options="{'no_open': True}"/>
                        <field name="production_qty"/>
                        <field name="mgq" readonly="1"/>
                        <field name="project_months" readonly="1"/>
                    </group>
                    <notebook>
                        <page string="Context">
                            <group col="2">
                                <group string="Commercial Context">
                                    <field name="order_id" options="{'no_open': True}"/>
                                    <field name="production_qty"/>
                                    <field name="mgq" readonly="1"/>
                                    <field name="project_months" readonly="1"/>
                                </group>
                                <group string="Core Metrics">
                                    <field name="base_rate_per_cum" readonly="1"/>
                                    <field name="total_rate_per_cum" readonly="1"/>
                                </group>
                            </group>
                        </page>
                        <page string="Per CUM Breakdown">
                            <group col="2">
                                <group>
                                    <field name="running_per_cum" readonly="1"/>
                                    <field name="depr_per_cum" readonly="1"/>
                                    <field name="dead_per_cum" readonly="1"/>
                                </group>
                                <group>
                                    <field name="margin_per_cum" readonly="1"/>
                                    <field name="material_per_cum" readonly="1"/>
                                    <field name="optional_per_cum" readonly="1"/>
                                </group>
                            </group>
                            <group string="Optional Services" colspan="4">
                                <field name="optional_line_ids" readonly="1">
                                    <list>
                                        <field name="name"/>
                                        <field name="code"/>
                                        <field name="charge_type"/>
                                        <field name="rate_value"/>
                                        <field name="per_cum"/>
                                    </list>
                                </field>
                            </group>
                        </page>
                        <page string="Base &amp; Final Rates">
                            <group col="2">
                                <group string="Plant Base Rates">
                                    <field name="prime_rate" readonly="1"/>
                                    <field name="optimize_rate" readonly="1"/>
                                    <field name="after_mgq_rate" readonly="1"/>
                                    <field name="ngt_rate" readonly="1"/>
                                </group>
                                <group string="All-In Rates">
                                    <field name="final_prime_rate" readonly="1"/>
                                    <field name="final_optimize_rate" readonly="1"/>
                                    <field name="final_after_mgq_rate" readonly="1"/>
                                </group>
                            </group>
                        </page>
                        <page string="Billing">
                            <group col="2">
                                <group string="Billing at Production">
                                    <field name="prime_bill" readonly="1"/>
                                    <field name="optimize_bill" readonly="1"/>
                                    <field name="after_mgq_bill" readonly="1"/>
                                </group>
                                <group string="Effective Rates">
                                    <field name="base_rate_per_cum" readonly="1"/>
                                    <field name="total_rate_per_cum" readonly="1"/>
                                </group>
                            </group>
                        </page>
                        <page string="Debug JSON">
                            <field name="prime_rate_log_json" nolabel="1" readonly="1" widget="text"/>
                        </page>
                    </notebook>
                </sheet>
                <footer>
                    <button string="Close" special="cancel" class="btn-secondary"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="action_batching_master_calculator" model="ir.actions.act_window">
        <field name="name">Batching Master Calculator</field>
        <field name="res_model">gear.batching.master.calculator</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

    <record id="view_sale_order_batching_calculator_button" model="ir.ui.view">
        <field name="name">sale.order.batching.calculator.button</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="gear_on_rent.view_sale_order_form_inherit_gear_on_rent"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                <button name="%(gear_on_rent.action_batching_master_calculator)d"
                        string="Open Batching Calculator"
                        type="action"
                        class="btn-secondary"
                        context="{'default_order_id': id, 'default_production_qty': gear_expected_production_qty}"/>
            </xpath>
        </field>
    </record>
</odoo>
