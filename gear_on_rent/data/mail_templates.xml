<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data noupdate="0">
    <record id="mail_template_daily_mo_report" model="mail.template">
      <field name="name">Gear On Rent Daily MO Report</field>
      <field name="model_id" ref="mrp.model_mrp_production"/>
      <field name="auto_delete" eval="True"/>
      <field name="email_from">{{ (object.x_sale_order_id and (object.x_sale_order_id.company_id.email or object.company_id.email)) or object.company_id.email or '' }}</field>
      <field name="partner_to">{{ (object.x_sale_order_id and (object.x_sale_order_id.partner_invoice_id.id or object.x_sale_order_id.partner_id.id)) or '' }}</field>
      <field name="subject">Daily Operational Report - {{ format_date((object.date_start or object.create_date or object.write_date or datetime.date.today()), lang_code=(object.x_sale_order_id and object.x_sale_order_id.partner_id and object.x_sale_order_id.partner_id.lang) or user.lang) }}</field>
      <field name="body_html" type="html">
        <div style="margin:0;padding:0;font-family:Arial,sans-serif;font-size:13px;line-height:1.6;color:#222;">
          <t t-set="lang_code" t-value="(object.x_sale_order_id and object.x_sale_order_id.partner_id and object.x_sale_order_id.partner_id.lang) or user.lang"/>
          <t t-set="report_date" t-value="object.date_start or object.create_date or object.write_date or datetime.date.today()"/>
          <t t-set="prime_qty" t-value="object.x_prime_output_qty or 0.0"/>
          <t t-set="ngt_qty" t-value="object.x_relief_qty or 0.0"/>
          <t t-set="target_qty_email" t-value="(object.x_monthly_order_id and object.x_monthly_order_id.monthly_target_qty) or (object.x_daily_target_qty or object.product_qty or 0.0)"/>
          <t t-set="standby_qty" t-value="max((target_qty_email or 0.0) - (prime_qty + ngt_qty), 0.0)"/>
          <t t-set="total_qty" t-value="prime_qty + ngt_qty + standby_qty"/>
          <t t-set="total_qty" t-value="prime_qty + ngt_qty + standby_qty"/>

          <p>Dear Team,</p>
          <p>I hope you are doing well.</p>
          <p>Please find below the <strong>Daily Operational Report</strong> for
            <strong><t t-esc="format_date(report_date, date_format='MMMM yyyy', lang_code=lang_code)"/></strong>, summarising the output and operational quantities for your review and records.</p>

          <p><strong>Daily Report Summary:</strong></p>
          <ul>
            <li><strong>Prime Output:</strong> <t t-esc="('%.2f' % prime_qty).rstrip('0').rstrip('.')"/> m³</li>
            <li><strong>NGT (No-Generation Time):</strong> <t t-esc="('%.2f' % ngt_qty).rstrip('0').rstrip('.')"/> m³</li>
            <li><strong>Optimised Standby:</strong> <t t-esc="('%.2f' % standby_qty).rstrip('0').rstrip('.')"/> m³</li>
            <li><strong>Total Quantity Handled:</strong> <t t-esc="('%.2f' % total_qty).rstrip('0').rstrip('.')"/> m³</li>
          </ul>

          <p>The detailed calculation sheets, quantity breakup, and No-Generation Time assessment annexures are attached for reference and verification.</p>
          <p><strong>Kindly acknowledge receipt of this report within the next 3 hours.</strong> If any clarification, correction, or additional information is required, please let us know.</p>

          <p>Thank you for your continued coordination.</p>
          <p>Warm regards,<br/>
             <t t-esc="object.company_id.name or 'Gear On Rent'"/></p>
        </div>
      </field>
    </record>

    <record id="mail_template_batching_quote_accept" model="mail.template">
      <field name="name">Batching Plant Quote Accepted</field>
      <field name="model_id" ref="sale.model_sale_order"/>
      <field name="auto_delete" eval="True"/>
      <field name="email_from">{{ (object.company_id.email or object.user_id.email) or '' }}</field>
      <field name="partner_to">{{ object.partner_id.id }}</field>
      <field name="subject">Batching Plant Quotation Accepted - {{ object.name }}</field>
      <field name="body_html" type="html">
<div style="margin: 0px; padding: 0px;">
    <p>Namaste <t t-out="object.partner_id.name or 'Customer'"/>,</p>
    <p>Your batching plant quotation <strong><t t-out="object.name"/></strong> has been accepted via the customer portal.</p>
    <p><strong>Highlights</strong></p>
    <ul>
      <li>Service Type: <t t-out="object.gear_service_type or '—'"/></li>
      <li>Capacity: <t t-out="object.gear_capacity_id.name or '—'"/></li>
      <li>MGQ: <t t-out="object.mgq_monthly or object.x_monthly_mgq or 0.0"/> m³</li>
      <li>Inventory Mode: <t t-out="object.x_inventory_mode or '—'"/></li>
      <li>Final Rate: <t t-out="object.gear_prime_rate_final or object.prime_rate or 0.0"/></li>
    </ul>
    <p>You can review the generated Sales Order here: <a t-att-href="object.get_portal_url()"><t t-out="object.get_portal_url()"/></a>.</p>
    <p>PDF copy of your quotation is available anytime from the portal: <a t-att-href="'/my/batching-plant/%s/pdf' % object.id">Download PDF</a>.</p>
    <p>We will process the sales order and share the finalized PDF shortly.</p>
    <p>--<br/><t t-out="object.company_id.name or ''"/><br/><t t-out="object.company_id.website or ''"/></p>
</div>
      </field>
    </record>
    <record id="mail_template_batching_quote_send" model="mail.template">
      <field name="name">Batching Plant: Send Quotation</field>
      <field name="model_id" ref="sale.model_sale_order"/>
      <field name="subject">{{ object.company_id.name }} Batching Plant Quotation (Ref {{ object.name or 'n/a' }})</field>
      <field name="email_from">{{ (object.user_id.email_formatted or object.company_id.email_formatted or user.email_formatted) }}</field>
      <field name="partner_to">{{ object.partner_id.id }}</field>
      <field name="body_html" type="html">
<div style="margin: 0px; padding: 0px;">
    <p>Hello  <t t-out="object.partner_id.name or 'Customer'"/>,</p>
    <p>Your batching plant quotation <strong><t t-out="object.name"/></strong> is ready for review.</p>
    <p><strong>Highlights</strong></p>
    <ul>
      <li>Service Type: <t t-out="object.gear_service_type or '—'"/></li>
      <li>Capacity: <t t-out="object.gear_capacity_id.name or '—'"/></li>
      <li>MGQ: <t t-out="object.mgq_monthly or object.x_monthly_mgq or 0.0"/> m³</li>
      <li>Inventory Mode: <t t-out="object.x_inventory_mode or '—'"/></li>
      <li>Final Rate: <t t-out="object.gear_prime_rate_final or object.prime_rate or object.gear_total_per_cum_rate or 0.0"/></li>
      <li>Optimize Rate: <t t-out="object.optimize_rate or 0.0"/></li>
      <li>After MGQ Rate: <t t-out="object.gear_after_mgq_rate_final or object.excess_rate or 0.0"/></li>
    </ul>
    <p>You can review and accept the quotation online: <a t-att-href="object.get_portal_url()"><t t-out="object.get_portal_url()"/></a>.</p>
    <p>A PDF copy is also attached.</p>
    <p>--<br/><t t-out="object.company_id.name or ''"/><br/><t t-out="object.company_id.website or ''"/></p>
</div>
      </field>
      <field name="report_template_ids" eval="[(4, ref('gear_on_rent.action_report_batching_plant_quote'))]"/>
      <field name="auto_delete" eval="True"/>
    </record>

    <!-- Custom invoice email for Monthly Work Orders -->
    <record id="mail_template_mwo_invoice_custom" model="mail.template">
      <field name="name">Gear Monthly Invoice (Customer)</field>
      <field name="model_id" ref="account.model_account_move"/>
      <field name="auto_delete" eval="True"/>
      <field name="email_from">{{ (object.company_id.email or user.email) or '' }}</field>
      <field name="partner_to">{{ object.partner_id.id }}</field>
      <field name="subject">Invoice {{ object.name or 'n/a' }} — Monthly RMC ({{ object.gear_period_start or object.invoice_date or '' }})</field>
      <field name="body_html" type="html">
        <div style="margin:0;padding:0;">
          <p>Dear <t t-esc="object.partner_id.name or 'Customer'"/>,</p>
          <p>Please find attached the monthly invoice <strong><t t-esc="object.name"/></strong> for your review and processing.</p>
          <!-- Derive quantities directly from invoice lines so summary matches the PDF lines -->
          <t t-set="prime_qty" t-value="sum(line.quantity for line in object.invoice_line_ids if 'Prime Output' in (line.name or '') or 'Prime Output' in (line.display_name or ''))"/>
          <t t-set="standby_qty" t-value="sum(line.quantity for line in object.invoice_line_ids if 'Optimized Standby' in (line.name or '') or 'Optimised Standby' in (line.name or '') or 'Optimized Standby' in (line.display_name or '') or 'Optimised Standby' in (line.display_name or ''))"/>
          <t t-set="ngt_qty" t-value="sum(line.quantity for line in object.invoice_line_ids if 'NGT' in (line.name or '') or 'No-Generation' in (line.name or '') or 'NGT' in (line.display_name or '') or 'No-Generation' in (line.display_name or ''))"/>
          <t t-set="total_qty" t-value="prime_qty + standby_qty + ngt_qty"/>

          <p><strong>Invoice summary:</strong></p>
          <ul>
            <li>Prime Output: <t t-esc="('%.2f' % prime_qty).rstrip('0').rstrip('.')"/> m³</li>
            <li>NGT (No-Generation Time): <t t-esc="('%.2f' % ngt_qty).rstrip('0').rstrip('.')"/> m³</li>
            <li>Optimised Standby: <t t-esc="('%.2f' % standby_qty).rstrip('0').rstrip('.')"/> m³</li>
            <li>Total Quantity: <t t-esc="('%.2f' % total_qty).rstrip('0').rstrip('.')"/> m³</li>
            <li>Total Invoice Value: <t t-esc="format_amount(object.amount_total, object.currency_id)"/></li>
          </ul>

          <p>All supporting documents and annexures, including the detailed quantity breakup and No-Generation Time assessment, are attached.</p>
          <p>Please confirm receipt and proceed with payment as per agreed terms. If you need any clarification or additional documentation, let us know.</p>
          <p>Warm regards,<br/>
             <t t-esc="object.company_id.name or ''"/></p>
        </div>
      </field>
    </record>
  </data>
</odoo>
