<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
    <record id="view_sale_order_form_inherit_rmc" model="ir.ui.view">
        <field name="name">sale.order.form.inherit.rmc</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
        <button name="action_create_rmc_workorder" 
            type="object" 
            string="Create RMC Workorder" 
             invisible="is_rmc_order == 'False'"
            class="btn-primary"/>
        <button name="action_view_workorders" 
            type="object" 
            string="View Workorders" 
                 invisible="is_rmc_order == 'False'"
            class="btn-secondary"/>
            </xpath>
            
            <xpath expr="//sheet/group/group[1]" position="after">
                <group>
                    <field name="is_rmc_order" readonly="True"/>
                    <field name="workorder_count" readonly="True"/>
                    <!-- Hidden technical field used in modifiers below -->
                    <field name="is_rmc_product" invisible="1"/>
                </group>
            </xpath>
            
            <xpath expr="//sheet/notebook/page[@name='order_lines']" position="after">
                <page string="RMC Details"  invisible="is_rmc_order == 'true'">
                    <group>
                        <field name="customer_provides_cement"/>
                        <field name="delivery_coordinates"/>
                        <field name="required_slump"/>
                        <field name="pour_structure"/>
                        <field name="helpdesk_ticket_id"/>
                        <field name="batch_count"/>
                        <field name="quality_check_count"/>
                    </group>
                    <group string="Batches">
                        <field name="batch_ids" readonly="True"/>
                    </group>
                    <!-- Removed unused Quality Checks and Weighbridge groups -->
                </page>
                <page string="RMC Quality / Cube Tests" invisible="is_rmc_order == 'False'">
                    <group>
                        <field name="cube_test_condition"/>
                        <button name="action_view_cube_tests" type="object" string="Open Cube Tests" class="oe_stat_button"/>
                        <field name="cube_tests_count" invisible="1"/>
                    </group>
                </page>
                <page string="RMC Reporting" invisible="is_rmc_order == 'False'">
                    <group>
                        <group>
                            <field name="reporting_enabled"/>
                            <field name="reporting_period"/>
                        </group>
                        <group>
                            <field name="last_sent_30d" readonly="1"/>
                            <field name="last_sent_7d" readonly="1"/>
                            <field name="last_sent_15d" readonly="1"/>
                        </group>
                    </group>
                </page>
            </xpath>

            <xpath expr="//sheet//div[@name='button_box']" position="inside">
                <button name="action_view_cube_tests" type="object" class="oe_stat_button" icon="fa-flask" modifiers='{"invisible": ["|", ["cube_tests_count","=",0], ["is_rmc_order","=", false]]}' string="Cube Tests"/>
            </xpath>
        </field>
    </record>
    </data>
</odoo>