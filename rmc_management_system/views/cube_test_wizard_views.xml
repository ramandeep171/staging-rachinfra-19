<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <record id="view_cube_test_wizard_form" model="ir.ui.view">
    <field name="name">rmc.cube.test.wizard.form</field>
    <field name="model">rmc.cube.test.wizard</field>
    <field name="arch" type="xml">
      <form string="Create Cube Test (Select Trigger)">
        <group>
          <group>
            <field name="sale_order_id" readonly="1"/>
            <field name="trigger_condition" required="1"/>
            <field name="assigned_user_id"/>
          </group>
          <group>
            <field name="create_7day"/>
            <field name="date_7day"/>
            <field name="create_28day"/>
            <field name="date_28day"/>
          </group>
        </group>
        <group>
          <field name="notes" placeholder="Notes"/>
        </group>
        <footer>
          <button name="action_create" type="object" string="Create" class="btn-primary"/>
          <button string="Cancel" class="btn-secondary" special="cancel"/>
        </footer>
      </form>
    </field>
  </record>

  <record id="action_cube_test_wizard" model="ir.actions.act_window">
    <field name="name">Create Cube Test (Select Trigger)</field>
    <field name="res_model">rmc.cube.test.wizard</field>
    <field name="view_mode">form</field>
    <field name="target">new</field>
    <field name="context">{
      'default_sale_order_id': active_id,
    }</field>
  </record>

  <record id="sale_order_server_action_cube_test_wizard" model="ir.actions.server">
    <field name="name">Create Cube Test / Trigger</field>
    <field name="model_id" ref="sale.model_sale_order"/>
    <field name="binding_model_id" ref="sale.model_sale_order"/>
    <field name="state">code</field>
    <field name="code">action = {
      'type': 'ir.actions.act_window',
      'name': 'Create Cube Test (Select Trigger)',
      'res_model': 'rmc.cube.test.wizard',
      'view_mode': 'form',
      'target': 'new',
      'context': {'default_sale_order_id': record.id},
    }</field>
  </record>

  <!-- Inject button on Sale Order header -->
  <record id="view_sale_order_form_inherit_rmc_cube_wizard" model="ir.ui.view">
    <field name="name">sale.order.form.inherit.rmc.cube.wizard</field>
    <field name="model">sale.order</field>
    <field name="inherit_id" ref="sale.view_order_form"/>
    <field name="arch" type="xml">
      <xpath expr="//header" position="inside">
        <button type="action"
                name="%(action_cube_test_wizard)d"
                string="Create Cube Test / Trigger"
                class="btn-secondary"
                modifiers='{"invisible": [["is_rmc_order", "=", false]]}'/>
      </xpath>
    </field>
  </record>
</odoo>
