<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="rmc_calculator_page" name="RMC Calculator Page">
        <t t-call="website.layout">
            <section style="padding: 60px 20px; background-color: #f2f6fc;">
                <div style="max-width: 800px; margin: auto; background: #fff; border-radius: 10px; padding: 40px; box-shadow: 0 0 10px rgba(0,0,0,0.05);">
                    <div style="text-align: center; margin-bottom: 40px;">
                        <h2 style="font-size: 32px; margin-bottom: 10px;">Get Instant Quote Calculator</h2>
                        <p style="font-size: 18px; color: #555;">Calculate your concrete requirements and get instant pricing with bulk discounts.</p>
                    </div>
                    <form method="POST" action="/calculate_quote">
                        <div style="display: flex; flex-wrap: wrap; gap: 20px;">
                            <div style="flex: 1; min-width: 250px;">
                                <label style="font-weight: bold; display: block; margin-bottom: 6px;">Project Type</label>
                                <select name="project_type" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
                                    <option>Select project type</option>
                                    <option>Residential Building</option>
                                    <option>Commercial Complex</option>
                                    <option>Infrastructure Project</option>
                                    <option>Industrial Construction</option>
                                </select>
                                <label style="font-weight: bold; display: block; margin-bottom: 6px;">Brand</label>
                                <select id="brand_select" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
                                    <option value="">All brands</option>
                                </select>
                            </div>
                            <div style="flex: 1; min-width: 250px;">
                                <label style="font-weight: bold; display: block; margin-bottom: 6px;">Concrete Grade</label>
                                <select name="grade" id="grade_select" data-placeholder="Select concrete grade" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
                                    <option value="">Select concrete grade</option>
                                    <t t-set="rmc_templates" t-value="request.env['product.template'].sudo().search([('categ_id.name', 'ilike', 'rmc'), ('sale_ok', '=', True), ('website_published', '=', True)])"/>
                                    <t t-foreach="rmc_templates" t-as="tmpl">
                                        <option t-att-value="tmpl.id"><t t-esc="tmpl.name"/></option>
                                    </t>
                                </select>
                                <div style="margin-top:8px;">
                                    <label style="font-weight: bold; display: block; margin: 8px 0 6px 0;">Grade Type</label>
                                    <select id="grade_type_select" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
                                        <option value="">All grade types</option>
                                    </select>
                                    <select id="variant_select" style="display:none; width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
                                        <option value="">Select variant (optional)</option>
                                    </select>
                                </div>
                            </div>
                            <div id="variant_details" style="margin-top:8px; font-size:0.95em; color:#333;"></div>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;">
                            <button id="open_dim_popup" type="button" class="btn btn-primary">Calculate Volume</button>
                            <input id="rmc_volume" placeholder="Volume (m³)" style="padding:10px; border-radius:4px; border:1px solid #ccc; min-width:150px;" />
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;">
                            <div style="flex: 1; min-width: 250px;">
                                <label style="font-weight: bold; display: block; margin-bottom: 6px;">Delivery Location</label>
                                <input type="text" name="location" placeholder="Enter address" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;" />
                            </div>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;">
                            <div style="flex: 1; min-width: 250px;">
                                <label style="font-weight: bold; display: block; margin-bottom: 6px;" for="rmc_city">City</label>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <input id="rmc_city" type="text" placeholder="Detected city" style="flex: 1; padding: 10px; border-radius: 5px; border: 1px solid #ccc;" />
                                    <button type="button" id="rmc_city_gps" class="btn btn-outline-primary" style="white-space: nowrap;">Use GPS</button>
                                </div>
                                <input id="rmc_zip" type="hidden" />
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <label style="font-weight: bold; display: block; margin-bottom: 6px;">Delivery Date</label>
                            <input type="date" name="delivery_date" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;" />
                        </div>
                        
                        <div style="margin-top: 30px; padding: 20px; border: 2px dashed #ccc; border-radius: 8px; background: #f5f9fd;" id="rmc-calculator-widget">
                            <div style="text-align: center; font-size: 18px; color: #777;">Estimated Total Cost</div>
                            <div class="rmc-price-pill" id="variant_price">Unit price: ₹0</div>
                            <div style="text-align: center; font-size: 36px; color: #007bff; font-weight: bold;" id="estimated_total">₹0</div>
                            <div class="rmc-price-summary">
                                <div class="rmc-summary-card">
                                    <div class="rmc-summary-label">Base Total</div>
                                    <div class="rmc-summary-value" id="base_price">₹0</div>
                                </div>
                                <div class="rmc-summary-card">
                                    <div class="rmc-summary-label">Bulk Discount</div>
                                    <div class="rmc-summary-value" id="bulk_discount">₹0</div>
                                </div>
                                <div class="rmc-summary-card">
                                    <div class="rmc-summary-label">Truck Loads</div>
                                    <div class="rmc-summary-value" id="truck_count">0</div>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 30px;">
                            <button id="calculate_quote_btn" type="button" style="flex: 1; background: #007bff; color: white; padding: 12px; border: none; border-radius: 6px; font-size: 16px;">Calculate Quote</button>
                            <button type="button" id="request_quote_btn" style="flex: 1; background: #ccc; padding: 12px; border: none; border-radius: 6px; font-size: 16px;">Request Detailed Quote</button>
                            <button type="button" id="add_to_cart_rmc" style="flex: 1; background: #28a745; color: white; padding: 12px; border: none; border-radius: 6px; font-size: 16px;">Add to Cart</button>
                        </div>
                    </form>
                </div>
            </section>
        </t>
    </template>
</odoo>
